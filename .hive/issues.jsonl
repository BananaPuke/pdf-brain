{"id":"pdf-brain--mwkor-mjd4i4atdkh","title":"Live System Integration Tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T17:08:18.629Z","updated_at":"2025-12-19T21:06:26.349Z","closed_at":"2025-12-19T21:06:26.349Z","parent_id":"pdf-brain--mwkor-mjd4i4a0ui9","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjd68pqlpas","title":"Add ingest lock to prevent concurrent ingests crashing daemon","description":"The daemon crashes when multiple ingest processes run concurrently. Need a file-based lock so only one ingest runs at a time. Other invocations should either wait or fail with a clear message.\n\nImplementation:\n1. Create lock file at ~/.pdf-library/ingest.lock with PID\n2. Check lock before starting ingest\n3. If locked by dead process, steal lock\n4. Release lock on completion/error\n5. Add --force flag to steal lock manually","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-19T17:56:59.085Z","updated_at":"2025-12-19T21:06:26.045Z","closed_at":"2025-12-19T21:06:26.045Z","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdaevbbhcr","title":"Spike: SQLite + sqlite-vector as PGlite alternative","description":"PGlite's WASM layer is causing daemon crashes under heavy embedding load. The socket layer is unstable with large vector payloads.\n\nSPIKE GOAL: Determine if SQLite + sqlite-vector is a viable replacement that avoids all this complexity.\n\nINVESTIGATE:\n1. https://github.com/sqliteai/sqlite-vector - vector similarity search for SQLite\n2. Bun's native SQLite support (bun:sqlite) - no WASM, native performance\n3. Can we get comparable vector search quality to pgvector?\n4. What's the migration path from current PGlite schema?\n\nSUCCESS CRITERIA:\n- [ ] sqlite-vector works in Bun context\n- [ ] Can store 1024-dim embeddings\n- [ ] Can do cosine similarity search\n- [ ] Performance is acceptable (benchmark vs PGlite)\n- [ ] No WASM memory limits to worry about\n\nIF VIABLE: This could eliminate the entire daemon/queue architecture complexity. Native SQLite in Bun = single process, no sockets, no WASM crashes.\n\nRelated: Daemon-with-Queue epic is a workaround for PGlite instability. If SQLite works, we might not need it.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T19:53:44.711Z","updated_at":"2025-12-19T21:00:55.652Z","closed_at":"2025-12-19T21:00:55.652Z","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2covdp","title":"Migration: PGLite → libSQL for Vector Storage","description":"PGLite with pgvector is a footgun. libSQL has native vector support, no extensions, no WASM complexity, no WAL accumulation, and just works.\n\n## Why Migrate\n\n**PGLite Pain Points:**\n- WAL accumulation - Multiple instances create orphaned WAL files (found 2.7GB cruft in /tmp)\n- NOTICE spam - Constant \"relation x already exists, skipping\" polluting logs\n- Extension loading - pgvector requires WASM bundle, adds ~15MB to package\n- Daemon complexity - Multi-process access requires socket server to prevent WAL issues\n- Homebrew deps - Some extensions need OS-level SQLite with extension support\n\n**libSQL Advantages:**\n- Native vector support - F32_BLOB(N) column type, no extensions\n- Battle-tested WAL - SQLite's WAL mode is rock solid\n- Tiny bundle - ~200KB vs ~15MB\n- Portable - No OS deps, no Homebrew, works everywhere\n- Optional cloud - Can connect to Turso for sync/replication later\n- Silent - No NOTICE spam, clean logs\n\n## Schema Translation\n\n| PGLite (pgvector) | libSQL | Notes |\n|-------------------|--------|-------|\n| vector(768) | F32_BLOB(768) | Dimension in parens |\n| embedding <-> $1 | vector_distance_cos(embedding, vector(?)) | Cosine distance |\n| 1 - (embedding <=> $1) | 1 - vector_distance_cos(...) | For similarity score |\n| $1::vector | vector(?) | Cast JSON array to vector |\n\n## Gotchas\n1. Vector dimension must match model (mxbai-embed-large = 1024)\n2. Distance vs Similarity: similarity = 1 - distance\n3. Vectors as JSON strings: args: [JSON.stringify(embedding)]\n4. No parameterized LIMIT - interpolate directly\n5. Close connections with db.close()\n\nSpike validated with real Ollama embeddings - it works.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-19T20:31:59.976Z","updated_at":"2025-12-19T21:06:37.558Z","closed_at":"2025-12-19T21:06:37.558Z","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2d3wn2","title":"Create libSQL Database service (TDD)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T20:31:59.991Z","updated_at":"2025-12-19T20:52:51.231Z","closed_at":"2025-12-19T20:52:51.231Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2d84de","title":"Migrate schema: documents, chunks, embeddings tables","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T20:31:59.996Z","updated_at":"2025-12-19T20:52:52.339Z","closed_at":"2025-12-19T20:52:52.339Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2dc4x1","title":"Implement vector search with vector_distance_cos","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T20:32:00.000Z","updated_at":"2025-12-19T20:52:53.469Z","closed_at":"2025-12-19T20:52:53.469Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2dfuyf","title":"Implement FTS5 fallback search","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T20:32:00.003Z","updated_at":"2025-12-19T21:02:55.335Z","closed_at":"2025-12-19T21:02:55.335Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2dl61c","title":"Data migration script: PGLite → libSQL","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T20:32:00.009Z","updated_at":"2025-12-19T21:00:53.652Z","closed_at":"2025-12-19T21:00:53.652Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2do8j0","title":"Update CLI to use libSQL Database layer","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T20:32:00.012Z","updated_at":"2025-12-19T21:00:54.764Z","closed_at":"2025-12-19T21:00:54.764Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2dqbe2","title":"Remove PGLite/daemon/socket code","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T20:32:00.014Z","updated_at":"2025-12-19T21:06:14.859Z","closed_at":"2025-12-19T21:06:14.859Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
{"id":"pdf-brain--mwkor-mjdbs2dr1es","title":"Load test: 1000+ embeddings without issues","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T20:32:00.015Z","updated_at":"2025-12-19T21:06:31.971Z","closed_at":"2025-12-19T21:06:31.971Z","parent_id":"pdf-brain--mwkor-mjdbs2covdp","dependencies":[],"labels":[],"comments":[]}
